<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Juego de Pelea 2 Jugadores</title>
  <style>
    body { margin: 0; background: #111; color: white; font-family: Arial, sans-serif; text-align: center; }
    canvas { background: linear-gradient(#222, #111); display: block; margin: 20px auto; border: 3px solid #fff; border-radius: 10px; }
    h1 { margin-top: 10px; }
  </style>
</head>
<body>
  <h1>Tekken -1</h1>
  <canvas id="gameCanvas" width="900" height="500"></canvas>
  <p>Jugador 1: W/A/S/D + F (puño) + G (patada)</p>
  <p>Jugador 2: Flechas + N (puño) + M (patada)</p>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    class Fighter {
      constructor(x, color, controls) {
        this.x = x;
        this.y = 400;
        this.width = 50;
        this.height = 100;
        this.color = color;
        this.health = 100;
        this.velocityX = 0;
        this.velocityY = 0;
        this.onGround = true;
        this.controls = controls;
        this.attacking = false;
        this.attackBox = null;
      }
      draw() {
        // Dibujar cuerpo
        ctx.fillStyle = this.color;
        ctx.fillRect(this.x, this.y, this.width, this.height);

        // Dibujar hitbox de ataque cuando está activo
        if (this.attackBox) {
          ctx.fillStyle = "rgba(255,255,255,0.4)";
          ctx.fillRect(this.attackBox.x, this.attackBox.y, this.attackBox.width, this.attackBox.height);
        }
      }
      update() {
        this.x += this.velocityX;
        this.y += this.velocityY;

        if (this.y + this.height < canvas.height) {
          this.velocityY += 1; // gravedad
          this.onGround = false;
        } else {
          this.velocityY = 0;
          this.y = canvas.height - this.height;
          this.onGround = true;
        }

        this.draw();
      }
      attack(opponent, type) {
        if (!this.attacking) {
          this.attacking = true;
          let w = 40, h = 30;
          let yOffset = type === "kick" ? 60 : 20;

          this.attackBox = {
            x: this.x + (this.color === "red" ? this.width : -w),
            y: this.y + yOffset,
            width: w,
            height: h
          };

          if (this.attackBox.x < opponent.x + opponent.width &&
              this.attackBox.x + this.attackBox.width > opponent.x &&
              this.attackBox.y < opponent.y + opponent.height &&
              this.attackBox.y + this.attackBox.height > opponent.y) {
            opponent.health -= (type === "kick" ? 15 : 10);
          }

          setTimeout(() => { this.attacking = false; this.attackBox = null; }, 300);
        }
      }
    }

    const player1 = new Fighter(200, "red", { left: "a", right: "d", up: "w", down: "s", punch: "f", kick: "g" });
    const player2 = new Fighter(650, "blue", { left: "ArrowLeft", right: "ArrowRight", up: "ArrowUp", down: "ArrowDown", punch: "n", kick: "m" });

    const keys = {};

    function drawHealthBar(fighter, x) {
      ctx.fillStyle = "grey";
      ctx.fillRect(x, 20, 300, 20);
      ctx.fillStyle = "lime";
      ctx.fillRect(x, 20, 3 * fighter.health, 20);
      ctx.strokeStyle = "white";
      ctx.strokeRect(x, 20, 300, 20);
    }

    function gameLoop() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = "#333";
      ctx.fillRect(0, canvas.height - 20, canvas.width, 20);

      // Movimiento Jugador 1
      player1.velocityX = 0;
      if (keys[player1.controls.left]) player1.velocityX = -5;
      if (keys[player1.controls.right]) player1.velocityX = 5;
      if (keys[player1.controls.up] && player1.onGround) player1.velocityY = -15;

      // Movimiento Jugador 2
      player2.velocityX = 0;
      if (keys[player2.controls.left]) player2.velocityX = -5;
      if (keys[player2.controls.right]) player2.velocityX = 5;
      if (keys[player2.controls.up] && player2.onGround) player2.velocityY = -15;

      player1.update();
      player2.update();

      drawHealthBar(player1, 50);
      drawHealthBar(player2, 550);

      ctx.fillStyle = "white";
      ctx.font = "20px Arial";
      ctx.fillText("Jugador 1", 50, 60);
      ctx.fillText("Jugador 2", 550, 60);

      if (player1.health <= 0 || player2.health <= 0) {
        ctx.fillStyle = "yellow";
        ctx.font = "40px Arial";
        ctx.fillText(player1.health <= 0 ? "Jugador 2 gana!" : "Jugador 1 gana!", 320, 250);
        return;
      }

      requestAnimationFrame(gameLoop);
    }

    document.addEventListener("keydown", (e) => {
      keys[e.key] = true;
      if (e.key === player1.controls.punch) player1.attack(player2, "punch");
      if (e.key === player1.controls.kick) player1.attack(player2, "kick");
      if (e.key === player2.controls.punch) player2.attack(player1, "punch");
      if (e.key === player2.controls.kick) player2.attack(player1, "kick");
    });

    document.addEventListener("keyup", (e) => { keys[e.key] = false; });

    gameLoop();
  </script>
</body>
</html>
